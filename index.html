<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0"
    />
    <title>Value driver tree demo</title>
  </head>
  <body>
    <header>
      <h1>Value driver tree demo</h1>
      <nav>
        <button id="btnEdit">Edit</button>
        <button id="btnTree">Tree</button>
        <button id="btnList">List</button>
      </nav>
    </header>
    <div id="editor-container" style="display: none">
      <div class="editor" contenteditable="true" id="editTextArea">Hello</div>
      <div class="error" id="error-message"></div>
      <button id="btnUpdate">Update</button>
    </div>
    <div id="tree-container" style="display: grid"></div>
    <div id="list-container" style="display: none"></div>
    <script type="module">
      import { nodeToText, updateList, updateTree } from "/src/nodes.ts";
      import { ParseVDT, sampleTreeComplex } from "/src/parser.ts";
      const editContainer = document.getElementById("editor-container");
      const treeContainer = document.getElementById("tree-container");
      const listContainer = document.getElementById("list-container");
      const editTextArea = document.getElementById("editTextArea");
      const btnEdit = document.getElementById("btnEdit");
      const btnTree = document.getElementById("btnTree");
      const btnList = document.getElementById("btnList");
      const btnUpdate = document.getElementById("btnUpdate");
      const errorMessage = document.getElementById("error-message");
      const parsed = ParseVDT(sampleTreeComplex);
      editTextArea.innerText = nodeToText(parsed);

      function showEditor() {
        editContainer.style.display = "block";
        treeContainer.style.display = "none";
        listContainer.style.display = "none";
      }
      function showTree() {
        editContainer.style.display = "none";
        treeContainer.style.display = "grid";
        listContainer.style.display = "none";
      }
      function showList() {
        editContainer.style.display = "none";
        treeContainer.style.display = "none";
        listContainer.style.display = "grid";
      }
      function parseTree() {
        try {
          const newTree = ParseVDT(editTextArea.innerText);
          updateTree(newTree, treeContainer);
          updateList(newTree, listContainer);
        } catch (error) {
          errorMessage.innerHTML = error;
        }
      }
      btnEdit.addEventListener("click", showEditor);
      btnTree.addEventListener("click", showTree);
      btnList.addEventListener("click", showList);
      btnUpdate.addEventListener("click", parseTree);
      updateTree(parsed, treeContainer);
      updateList(parsed, listContainer);
    </script>
  </body>
</html>
